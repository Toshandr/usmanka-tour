<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= tour.title %> — Усманка-уикенд</title>
  <meta name="description" content="<%= tour.description %>" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4CAF50',
            accent: '#FF9800',
            'dark-bg': '#0a0a0a',
            'dark-card': '#111111',
            'dark-border': '#333333'
          }
        }
      }
    }
  </script>

  <style>
    html { scroll-behavior: smooth; }
    body {
      background: #0f172a;
      font-size: 16px;
      line-height: 1.6;
    }
    .glass {
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(71, 85, 105, 0.3);
    }
    .gradient-text {
      background: linear-gradient(90deg, #4CAF50, #FF9800);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .feature-card:hover {
      transform: translateY(-5px);
      transition: transform 0.3s ease;
    }
    .btn-primary {
      background: linear-gradient(90deg, #4CAF50, #689F38);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
    }
  </style>
</head>
<body class="text-slate-100 antialiased">

  <div class="max-w-6xl mx-auto px-4 sm:px-6">

    <header class="flex items-center justify-between py-6 sticky top-0 z-30 glass backdrop-blur-md">
      <a href="/" class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-tr from-primary to-accent flex items-center justify-center font-bold text-white shadow-lg">
          <i class="fas fa-leaf"></i>
        </div>
        <div>
          <h1 class="text-lg font-semibold leading-tight"><%= tour.title %></h1>
          <p class="text-xs text-slate-400">20–21 июня 2026</p>
        </div>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm text-slate-300">
        <a href="#about" class="hover:text-primary transition-colors">О туре</a>
        <a href="#schedule" class="hover:text-primary transition-colors">Расписание</a>
        <a href="#tariffs" class="hover:text-primary transition-colors">Тарифы</a>
        <a href="#contact" class="px-4 py-2 btn-primary rounded-lg text-white font-medium">Забронировать</a>
      </nav>
    </header>

    <section id="about" class="mt-10 mb-20">
      <div class="text-center mb-10">
        <h2 class="text-4xl md:text-5xl font-extrabold leading-tight mb-4">
          <% var titlePart = tour.title.indexOf(' на ') !== -1 ? tour.title.split(' на ')[0] : tour.title; %><%= titlePart %> на <span class="gradient-text">Усманке</span>
        </h2>
        <p class="text-xl text-slate-300 max-w-3xl mx-auto">
          <%= tour.description %>
        </p>
      </div>

      <div class="relative overflow-hidden rounded-2xl mb-10">
        <img src="<%= tour.image %>" alt="<%= tour.title %>" class="w-full h-96 object-cover" />
      </div>

      <div class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">1. Архитектура тура</h3>
        <ul class="space-y-3 text-slate-300">
          <% if (tour.architecture && tour.architecture.length) { tour.architecture.forEach(function(item) { %>
          <li class="flex items-start gap-3">
            <i class="fas fa-check text-primary mt-1"></i>
            <span><%= item %></span>
          </li>
          <% }); } %>
        </ul>
      </div>

      <div class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">2. ЭТО ДЛЯ ВАС если</h3>
        <ul class="space-y-3 text-slate-300">
          <% if (tour.for_you && tour.for_you.length) { tour.for_you.forEach(function(item) { %>
          <li class="flex items-start gap-3">
            <i class="fas fa-star text-accent mt-1"></i>
            <span><%= item %></span>
          </li>
          <% }); } %>
        </ul>
      </div>

      <section id="schedule" class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">3. Расписание</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="text-xl font-semibold mb-4">День 1</h4>
            <div class="space-y-3">
              <% if (tour.schedule_day1 && tour.schedule_day1.length) { tour.schedule_day1.forEach(function(row) { %>
              <div class="flex gap-4 p-3 rounded-lg hover:bg-dark-border transition-colors">
                <span class="text-primary font-semibold w-24"><%= row.time %></span>
                <div>
                  <div class="font-medium"><%= row.title %></div>
                  <% if (row.desc) { %>
                  <div class="text-sm text-slate-400"><%= row.desc %></div>
                  <% } %>
                </div>
              </div>
              <% }); } %>
            </div>
          </div>

          <div>
            <h4 class="text-xl font-semibold mb-4">День 2</h4>
            <div class="space-y-3">
              <% if (tour.schedule_day2 && tour.schedule_day2.length) { tour.schedule_day2.forEach(function(row) { %>
              <div class="flex gap-4 p-3 rounded-lg hover:bg-dark-border transition-colors">
                <span class="text-accent font-semibold w-24"><%= row.time %></span>
                <div>
                  <div class="font-medium"><%= row.title %></div>
                  <% if (row.desc) { %>
                  <div class="text-sm text-slate-400"><%= row.desc %></div>
                  <% } %>
                </div>
              </div>
              <% }); } %>
            </div>
          </div>
        </div>
      </section>

      <div class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">4. Что получите</h3>
        <ul class="space-y-3 text-slate-300">
          <% if (tour.benefits && tour.benefits.length) { tour.benefits.forEach(function(item) { %>
          <li class="flex items-start gap-3">
            <i class="fas fa-gift text-primary mt-1"></i>
            <span><%= item %></span>
          </li>
          <% }); } %>
        </ul>
      </div>

      <section id="tariffs" class="mb-10">
        <h3 class="text-2xl font-bold mb-6 text-center">5. Тарифы</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% if (tour.tariffs && tour.tariffs.length) { tour.tariffs.forEach(function(tariff) { %>
          <div class="glass p-6 rounded-2xl feature-card transition-all hover:shadow-2xl">
            <div class="text-center mb-4">
              <h4 class="text-xl font-bold mb-2"><%= tariff.name %></h4>
              <div class="text-4xl font-extrabold text-primary mb-2">
                <% if (tariff.price === 0) { %>
                По запросу
                <% } else { %>
                <%= tariff.price %> ₽
                <% } %>
              </div>
              <% if (tariff.wine > 0) { %>
              <p class="text-xs text-slate-400">+ <%= tariff.wine %> ₽ винная дегустация</p>
              <% } %>
            </div>
            
            <div class="space-y-2 mb-6 text-sm">
              <% if (tariff.room && tariff.room !== 'Нет') { %>
              <div class="flex items-start gap-2">
                <i class="fas fa-bed text-accent mt-1"></i>
                <span class="text-slate-300"><%= tariff.room %></span>
              </div>
              <% } %>
              <% if (tariff.accommodation && tariff.accommodation !== 'Нет') { %>
              <div class="flex items-start gap-2">
                <i class="fas fa-users text-accent mt-1"></i>
                <span class="text-slate-300"><%= tariff.accommodation %></span>
              </div>
              <% } %>
            </div>
            
            <button type="button" class="w-full btn-primary px-6 py-3 rounded-lg text-white font-semibold booking-btn hover:scale-105 transition-transform" data-tour="<%= tour_key %>" data-tariff="<%= tariff.name %>" data-price="<%= tariff.price %>">
              <i class="fas fa-check-circle mr-2"></i>Забронировать
            </button>
          </div>
          <% }); } %>
        </div>
      </section>

      <div class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">6. Ведущие</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <% if (tour.leaders && tour.leaders.length) { tour.leaders.forEach(function(leader) { %>
          <div class="flex items-start gap-4">
            <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0">
              <i class="fas fa-user text-primary text-xl"></i>
            </div>
            <div>
              <h4 class="font-semibold text-lg"><%= leader.name %></h4>
              <p class="text-slate-300 font-medium"><%= leader.role %></p>
              <% if (leader.details && leader.details.length) { %>
              <ul class="mt-2 space-y-1 text-sm text-slate-400">
                <% leader.details.forEach(function(line) { %>
                <li class="flex items-start gap-2">
                  <i class="fas fa-minus text-primary mt-1.5 text-xs"></i>
                  <span><%= line %></span>
                </li>
                <% }); %>
              </ul>
              <% } %>
            </div>
          </div>
          <% }); } %>
        </div>
      </div>

      <% if (tour.included && tour.included.length) { %>
      <div class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">7. Включено в тур</h3>
        <ul class="space-y-3 text-slate-300">
          <% tour.included.forEach(function(item) { %>
          <li class="flex items-start gap-3">
            <i class="fas fa-check text-primary mt-1"></i>
            <span><%= item %></span>
          </li>
          <% }); %>
        </ul>
      </div>
      <% } %>

      <% if (tour.what_to_bring && tour.what_to_bring.length) { %>
      <div class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6">8. Что взять с собой</h3>
        <div class="space-y-6">
          <% tour.what_to_bring.forEach(function(block) { %>
          <div>
            <h4 class="font-semibold text-lg mb-2 text-slate-200"><%= block.title %></h4>
            <ul class="space-y-1 text-slate-300 text-sm">
              <% if (block.items && block.items.length) { block.items.forEach(function(item) { %>
              <li class="flex items-start gap-2">
                <i class="fas fa-circle text-primary text-[6px] mt-2"></i>
                <span><%= item %></span>
              </li>
              <% }); } %>
            </ul>
          </div>
          <% }); %>
        </div>
      </div>
      <% } %>

      <% if (tour.faq_extra && tour.faq_extra.length >= 2) { %>
      <section id="contact" class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6"><%= (tour.included && tour.included.length) || (tour.what_to_bring && tour.what_to_bring.length) ? '9' : '7' %>. FAQ</h3>
        <div class="space-y-4">
          <% for (var i = 0; i < tour.faq_extra.length; i += 2) { %>
          <div class="p-4 rounded-lg bg-dark-card">
            <h4 class="font-semibold mb-2"><%= tour.faq_extra[i] %></h4>
            <p class="text-slate-300 text-sm"><%= tour.faq_extra[i + 1] %></p>
          </div>
          <% } %>
        </div>
      </section>
      <% } else { %>
      <section id="contact" class="glass p-8 rounded-2xl mb-10 feature-card transition-all">
        <h3 class="text-2xl font-bold mb-6"><%= (tour.included && tour.included.length) || (tour.what_to_bring && tour.what_to_bring.length) ? '9' : '7' %>. Контакты</h3>
        <p class="text-slate-300">Телефон: <a href="tel:<%= contact_phone.replace(/\s/g, '') %>" class="text-primary"><%= contact_phone %></a>. Email: <a href="mailto:<%= contact_email %>" class="text-primary"><%= contact_email %></a>. Место отправления: <%= departure_place %>.</p>
      </section>
      <% } %>

    </section>

    <footer class="border-t border-dark-border mt-12 py-8 mb-10">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6 text-sm text-slate-400">
        <a href="/" class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-tr from-primary to-accent flex items-center justify-center font-bold text-white text-xs">
            <i class="fas fa-leaf"></i>
          </div>
          <div>← Назад к турам</div>
        </a>
        <div>© 2026 Усманка-уикенд — Все права защищены</div>
      </div>
    </footer>

  </div>

  <div id="paymentModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="glass p-8 rounded-2xl max-w-md w-full mx-4">
      <h3 class="text-2xl font-bold mb-4">Оплата тура</h3>
      <form id="paymentForm">
        <div class="space-y-4 mb-6">
          <div>
            <label class="block text-sm text-slate-300 mb-1">Имя</label>
            <input type="text" name="name" id="paymentName" class="w-full bg-dark-card border border-dark-border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" required />
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Телефон</label>
            <input type="tel" name="phone" id="paymentPhone" class="w-full bg-dark-card border border-dark-border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" required />
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Email</label>
            <input type="email" name="email" id="paymentEmail" class="w-full bg-dark-card border border-dark-border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" required />
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Тариф</label>
            <input type="text" name="tariff" id="paymentTariff" readonly class="w-full bg-dark-card border border-dark-border rounded-lg px-4 py-2 opacity-70" />
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Сумма</label>
            <input type="text" name="amount" id="paymentAmount" readonly class="w-full bg-dark-card border border-dark-border rounded-lg px-4 py-2 font-bold text-primary opacity-70" />
          </div>
          <input type="hidden" name="tour" id="paymentTour" />
        </div>
        <div class="flex gap-3">
          <button type="submit" class="flex-1 btn-primary px-6 py-3 rounded-lg text-white font-medium flex items-center justify-center gap-2">
            <i class="fas fa-paper-plane"></i>
            Отправить заявку
          </button>
          <button type="button" id="closePaymentBtn" class="px-6 py-3 border border-dark-border rounded-lg hover:bg-dark-border">
            Отмена
          </button>
        </div>
      </form>
    </div>
  </div>

  <script src="/js/common.js"></script>
  <script>
    document.body.dataset.tourType = '<%= tour_key %>';
    document.addEventListener('DOMContentLoaded', function() {
      var btns = document.querySelectorAll('.booking-btn');
      for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener('click', function() {
          var tour = this.getAttribute('data-tour');
          var tariff = this.getAttribute('data-tariff');
          var price = parseInt(this.getAttribute('data-price'), 10);
          if (typeof openPayment === 'function') openPayment(tour, tariff, price);
        });
      }
      var closeBtn = document.getElementById('closePaymentBtn');
      if (closeBtn && typeof closePayment === 'function') {
        closeBtn.addEventListener('click', closePayment);
      }
    });
  </script>

</body>
</html>
